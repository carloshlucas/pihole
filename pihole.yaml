---
# Create Namespace

apiVersion: v1
kind: Namespace
metadata:
  name: pi-hole
---
# Create Secret (echo -n your_password | base64)

apiVersion: v1
kind: Secret
metadata:
  name: pihole-secret
  namespace: pi-hole
type: Opaque
data:
    password: Q2FzYUAxMjMK
---
# Create Persistent Volume

apiVersion: v1
kind: PersistentVolume
metadata:
  name: "pihole"
  labels:
    type: "local"
spec:
  storageClassName: "manual"
  capacity:
    storage: "500Mi"
  accessModes:
    - ReadWriteOnce
  nfs:
    path: /mnt/chlabpihole01/pihole
    server: 192.168.15.21
---
# Create Persistent Volume Claim

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  namespace: "pi-hole"
  name: "pihole"
spec:
  storageClassName: "manual"
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: "500Mi"
---
# TLS Secret

apiVersion: v1
kind: Secret
metadata:
  name: secret-tls-pihole
  namespace: pi-hole
type: kubernetes.io/tls
data:
  # the data is abbreviated in this example
  tls.crt: |
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlGakRDQ0JIU2dBd0lCQWdJVEpRQUFBQ0hDVjZDSVd0bDhwQUFBQUFBQUlUQU5CZ2txaGtpRzl3MEJBUXNGDQpBREJMTVJVd0V3WUtDWkltaVpQeUxHUUJHUllGYkc5allXd3hGVEFUQmdvSmtpYUprL0lzWkFFWkZnVmphR3hoDQpZakViTUJrR0ExVUVBeE1TWTJoc1lXSXRRMGhNUVVKRFFUQXhMVU5CTUI0WERUSXdNVEl3TnpFM05UTTFObG9YDQpEVEl5TVRJd056RTNOVE0xTmxvd1ZqRUxNQWtHQTFVRUJoTUNUa3d4Q3pBSkJnTlZCQWdUQWs1TU1Rc3dDUVlEDQpWUVFIRXdKT1RERUxNQWtHQTFVRUNoTUNUa3d4SURBZUJnTlZCQU1URjJOb2JHRmljR2xvYjJ4bExtTm9iR0ZpDQpMbXh2WTJGc01JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBeVFXMjJwaUh3L2ZaDQp4VTFKRVU5NmhFY0JiUkRUY0hONUdoS0p0MC8za0hkM3hCbmNvWVRaZWtMV2p6SGxsZHEzZk4yZDhvMXlCaVV6DQowMmZnRzJIazVXanM5aTA1eDlkc1lBZVk4RHd4YXNNWitJQy9KanRLMHEyL3BGcmVxRXFDc1FxMFVtMk5BeVNBDQpiSFVjdnJydGlGK3QrNFR4WDJMOVRRV2ZHeHpRcFVOS1hqSlRoZmRhc2hCdFUzS1pZV0dJR0pHd2VRS0IwOU1xDQpwdnBubWlvc0d0UTZ2NVIvVU15TUVkUXp0S2h1UWVuVG5nU0tGM2Y1ZmlVMy9iVHRyZjV3Z3IvdlBiV2VYbFFxDQptQ1hqcnl0MkdodVBabnVxeFNNUWpONFNGeFE3eGJweDlkQXhkaG5TcHJkZVRocUJZa09oTHJualJKelh6NHN4DQo3aHZWaUNQV3d3SURBUUFCbzRJQ1hEQ0NBbGd3TWdZRFZSMFJCQ3N3S1lJWFkyaHNZV0p3YVdodmJHVXVZMmhzDQpZV0l1Ykc5allXeUNEakU1TWk0eE5qZ3VNVFV1TVRnd01CMEdBMVVkRGdRV0JCUy9TdU9VSGVzeWt4VHBSTEMyDQpibFNtZkIzM0hUQWZCZ05WSFNNRUdEQVdnQlQxMHY1c2N2NG9JRzBETDNydEZuTEhodVlLUFRDQjBnWURWUjBmDQpCSUhLTUlISE1JSEVvSUhCb0lHK2hvRzdiR1JoY0Rvdkx5OURUajFqYUd4aFlpMURTRXhCUWtOQk1ERXRRMEVzDQpRMDQ5WTJoc1lXSmpZVEF4TEVOT1BVTkVVQ3hEVGoxUWRXSnNhV01sTWpCTFpYa2xNakJUWlhKMmFXTmxjeXhEDQpUajFUWlhKMmFXTmxjeXhEVGoxRGIyNW1hV2QxY21GMGFXOXVMRVJEUFdOb2JHRmlMRVJEUFd4dlkyRnNQMk5sDQpjblJwWm1sallYUmxVbVYyYjJOaGRHbHZia3hwYzNRL1ltRnpaVDl2WW1wbFkzUkRiR0Z6Y3oxalVreEVhWE4wDQpjbWxpZFhScGIyNVFiMmx1ZERDQnhBWUlLd1lCQlFVSEFRRUVnYmN3Z2JRd2diRUdDQ3NHQVFVRkJ6QUNob0drDQpiR1JoY0Rvdkx5OURUajFqYUd4aFlpMURTRXhCUWtOQk1ERXRRMEVzUTA0OVFVbEJMRU5PUFZCMVlteHBZeVV5DQpNRXRsZVNVeU1GTmxjblpwWTJWekxFTk9QVk5sY25acFkyVnpMRU5PUFVOdmJtWnBaM1Z5WVhScGIyNHNSRU05DQpZMmhzWVdJc1JFTTliRzlqWVd3L1kwRkRaWEowYVdacFkyRjBaVDlpWVhObFAyOWlhbVZqZEVOc1lYTnpQV05sDQpjblJwWm1sallYUnBiMjVCZFhSb2IzSnBkSGt3SVFZSkt3WUJCQUdDTnhRQ0JCUWVFZ0JYQUdVQVlnQlRBR1VBDQpjZ0IyQUdVQWNqQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0V3WURWUjBsQkF3d0NnWUlLd1lCQlFVSEF3RXdEUVlKDQpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFKblkzMUxXcEtTa0dETFlyYS9VMFJjNEpGYVVDSGFlbHp4UENOUU40TDByDQo3N0x2R2FGRmlGc2RxYU5USVB4NnpTUnBvVWF0N2JQTmEwWlE4dndmOXpnVEIyNTBHT25YZWlxVE9VMnVUeEFrDQppRlBXdTR0bFRaZW9OSnE4NURBSnVYUW1KMXR4RnpURHRyb3NXRHdialQ4RTVFckdRV0hVaU5CMWdVbGJQQmFLDQp0NExxeFFCKzI4NlFscHpmeGs3WHZHM2VuaUFOZmlqUGU2N0x4eFltU1BwdGpaSUNoaDhJL2tqYmRJNUoxdWtJDQpYdzg4Y2tGNGE3Q3poNlh1bUFVN1NHbTEvSTJieEZZYWxKQ3d0OUtTL2xvM3BJeUhSSFJYdUlQQ2c3amJ1RHVVDQpWUnkyZEQwMHZQcmw2bkRSeUd5bUh3Y0NnaFNQVi9oMWNkVTJOR0xkQ3BnPQ0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ0K
  tls.key: |
    LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRREpCYmJhbUlmRDk5bkYKVFVrUlQzcUVSd0Z0RU5Od2Mza2FFb20zVC9lUWQzZkVHZHloaE5sNlF0YVBNZVdWMnJkODNaM3lqWElHSlRQVApaK0FiWWVUbGFPejJMVG5IMTJ4Z0I1andQREZxd3huNGdMOG1PMHJTcmIra1d0Nm9Tb0t4Q3JSU2JZMERKSUJzCmRSeSt1dTJJWDYzN2hQRmZZdjFOQlo4YkhOQ2xRMHBlTWxPRjkxcXlFRzFUY3BsaFlZZ1lrYkI1QW9IVDB5cW0KK21lYUtpd2ExRHEvbEg5UXpJd1IxRE8wcUc1QjZkT2VCSW9YZC9sK0pUZjl0TzJ0L25DQ3YrODl0WjVlVkNxWQpKZU92SzNZYUc0OW1lNnJGSXhDTTNoSVhGRHZGdW5IMTBERjJHZEttdDE1T0dvRmlRNkV1dWVORW5OZlBpekh1Ckc5V0lJOWJEQWdNQkFBRUNnZ0VBTitlZzdMWVN1OHRJQXZqMVl4MEpZNVFqcjJOSWlqTnk4RzlMWVhHWjFkR0QKdTBPOStpVnFIZmhNbDFJM0dTL1VhNk51YzdBbWo5TDAwTXhJcFJUYWhYcGl2Q3ZqcjlJWFQ3V05NUEpzZzlaeQplSXZGblNwTUtyOHJWdGYycURMZ21iL3lXaUloWDBoZGRzd3pERkFNRXlzWXhhUTVSRi9STmdSa05UUVVTb0VuCmdncC9JN1RWdGhPRVlITktkaURMYnl2eHFwZWV1NWMybEcvM0FTNWIzc25STUFNOVZuYnZ4TUNqQkxXQmtvVzQKT09uZ3lzSkJOaEg3SnBSRlBnUmVVLzZJTFVES2FpVEwyeFpoRVJETmQ5UnRuYzZaVXI4cVdMR2dVZlV1MVlZZApGaTluVFh0VzMyWk0wREpFOGJpa0NIU2F3RUpDQUVEaFBrTzdURFZQWVFLQmdRRDVuNGZjdTcyZ2V4cXJtR2gvCnpUZHZrU3hIbENReGVkeHB6TDQrY2VVbGFnRVY5UEJoVllOOVJDU1h4NVpqR0Rwano0ZWZNWWdFQVppSWRUbkIKY1dHNjdBcG9haGRIZ2ZiWmo4cVdtaU1qRXhjeW1Sd0p0b1Y0OW1lNnVoVG9sNjJlRno2SlBOUnNvejVjSmlLKwpPSDRZTTByaWcwK1lzL2VQTzNJemRnU24rUUtCZ1FET0tGalFGem10N1FGYUwxZ0txNU5IQld5bFNLSFhnd2psCjhFQlRnT2h5OTkrSVVxN3hDZmszdy8wVzNWd2VHS1RBWFdPam50bTlJVU5EeXg5MHJtclFSVkN6K1J0K0hyTS8KeVRQL3BCc0dveGlmMnBvTFIvall5bWQrblA5UVZTc29lajhhU3JVQWdmczlIUnYwNHJ2RE9xR05GdHJobzZzMgpLZGVZNmVuN213S0JnUUMvRGNyK3R2SzhFWHlvT1U1Q0F0K2JGSkcvZHpMOGF6aTRBV3phZm5IVDRQNVR2OVQ3CnFtZXBTSzU1UE5sdG51MlIxeFVHVXZLM25rRVFzQ2cwVm9ObWZhSzVwL21KVVgrTnBQQjV0QitRaU53SWJnZDMKcDZzZ21mZHFnMkhkWTdvT2RkdjNUZ2VIM3Ftci9jUTVzeU5QZ25LZVM4SndMYzRjWW5OVno4NWdnUUtCZ0VDRQpnL2JycmROdW5zTzRtVmNOaHhQczhLbHhaNlRvanpwV3krcldKdWtFQmVMRjdaWGx4eWJhb1RRc3BvMk1yTksrCjUxWG5lc0VqemNkRHBGNkJ6MC9Ld1l6eFl0Yy9pRjFuL0d2KzBhNXNFR0xHcVBycTFVZ1RYL3hSNmQwY0tsdUsKbG9FRjdFdHlZa3duOWYzWGoyZHp5K2M1eGRwanZFdEJJUVhyL3B3TkFvR0FhRGlEYW9hN29kTWJreXFZUHF0eApnbHVPN1ZodTNkWlpaRU1mdW53S1h6NWFlRUZXV3hEREZ5cFdlSm90V0NmMFdKUW43R2lLUDFES2Z6a2NZdklmCnh5Mm0zZTJXZk1LU1NaVXc1cm42dDJOWGRrWG9oWHZhaWVoRWxUK3R6bThnRTN4NFdNUmlYZTYrY0ZKYUkyTU4KL2V0dDBKN04xUWRXdTV1ditYK2p1RWs9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
---
# Ingress

apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  namespace: pi-hole
  name: ingress
  annotations:
    kubernetes.io/ingress.class: "nginx"
spec:
  rules:
  - host: chlabpihole.chlab.local #change the name to your fqdn
    http:
      paths:
        - path: /
          backend:
            serviceName: pihole-tcp
            servicePort: 80
  tls:                         #If you are not using certificates remove tls part
  - hosts:
    - chlabpihole.chlab.local
    secretName: secret-tls-pihole

---
